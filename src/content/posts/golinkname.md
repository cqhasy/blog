---
title: "go:linknameçš„ä½¿ç”¨ä¸åŸç†"
published: 2025-08-26
tags: [Markdown, Blogging]
---

# go:linkname

æœ€è¿‘åœ¨æosppæ—¶é‡åˆ°äº†ä¸ªéš¾é¢˜ï¼Œä¸ºåˆ†æruntimeæ ˆå¹¶ä¸spanidå’Œtraceidé€šè¿‡labelç»“åˆï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°pprofåŒ…çš„cpu_profiileï¼Œä½†æ˜¯ç›®å‰çš„å¯¹äºå…¨å±€cpuprofileå¢åŠ labelçš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡ctxå»ä¼ é€’ï¼Œç”±äºæˆ‘ä»¬çš„agentéœ€è¦æ··åˆç¼–è¯‘åˆ°ç”¨æˆ·ä»£ç ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´å¦‚æœæˆ‘ä»¬åœ¨agentè®¾ç½®å…¨å±€ctxå»ä¼ é€’labelçš„è¯ï¼Œç”¨æˆ·å°±å¯èƒ½ä¼šå¯¹é“¾è·¯é€ æˆç ´åï¼ˆç”¨æˆ·è¦å¢æ·»è‡ªå·±çš„labelä¹Ÿè¦å»åˆ›å»ºctx,è€Œè¿™ä¼šè¦†ç›–ğŸ˜­ï¼‰ã€‚ç›®å‰æœ‰ä¸¤ç§æ€è·¯ï¼Œç¬¬ä¸€ç§æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œæˆ‘å¯ä»¥åœ¨toolkitå»æš´éœ²ä¸€ä¸ªå‡½æ•°è®©ç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°å½“å‰çš„profile ctxï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥åœ¨è¿™ä¸ªctxçš„åŸºç¡€ä¸Šå»å¢æ·»labelï¼Œä¸ä¼šé€ æˆlabelä¸¢å¤±æˆ–æ··ä¹±ï¼Œä½†è¿™æ ·ä¼šå¯¹ç”¨æˆ·é€ æˆä»£ç çš„ä¾µå…¥ï¼Œä¸”ä¼šå¢åŠ ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬ï¼Œå¹¶ä¸æ˜¯æœ€ä¼˜é€‰æ‹©ï¼Œæ‰€ä»¥å°±éœ€è¦èµ°ç¬¬äºŒæ¡è·¯ï¼Œé‡å†™ï¼ˆæˆ–æ–°å¢ï¼‰pprofçš„éƒ¨åˆ†æ–¹æ³•ï¼Œæ¥å®ç°ä¸éœ€è¦å€ŸåŠ©ctxä¼ é€’å°±èƒ½è®¾ç½®labelçš„æ–¹æ³•ã€‚æ­£å½“æˆ‘å€ŸåŠ©aiåˆ†ææºç æ—¶ï¼Œä¸€ä¸ªä¸å¥½çš„æ¶ˆæ¯ä¼ æ¥ï¼Œæœ€ä¸ºå…³é”®çš„è®¾ç½®labelçš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸ºå¯¼å‡ºçš„ğŸ˜…ã€‚

æˆ‘èµç¾AIï¼ŒGPTçœŸæ˜¯ä¸ªå¥½ä¸œè¥¿å•Šï¼Œæ­£å½“æˆ‘ä»¥ä¸ºæˆ‘éš¾é“è¦å»é‡å†™è¿™ä¸€æ•´å¥—æ–¹æ³•æ—¶ï¼Œæˆ‘é€‚æ—¶çš„å»å‘GPTè¯‰äº†ä¸€ä¸‹è‹¦ï¼Œæ‚¨çŒœæ€ä¹ˆç€ï¼ŒGPTç›´æ¥ç»™äº†æˆ‘ä¸€ä¸ªå¤§å®è´ï¼šgo:linknameğŸ˜­ã€‚

è¿™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»¥ä¸‹æ˜¯å®˜æ–¹ä»‹ç»ï¼š

```go
//go:linkname localname [importpath.name]  ï¼ˆ//åè¦ç´§è·Ÿgoå“¦ï¼Œä¸è¦æœ‰ç©ºæ ¼ï¼‰
```

è¿™ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤çš„[ä½œç”¨åŸŸ](https://zhida.zhihu.com/search?content_id=186045598&content_type=Article&match_order=1&q=ä½œç”¨åŸŸ&zhida_source=entity)å¹¶ä¸æ˜¯ç´§è·Ÿçš„ä¸‹ä¸€è¡Œä»£ç ï¼Œè€Œæ˜¯åŒä¸€ä¸ªåŒ…ä¸‹ç”Ÿæ•ˆã€‚`//go:linkname`å‘Šè¯‰ Go çš„[ç¼–è¯‘å™¨](https://zhida.zhihu.com/search?content_id=186045598&content_type=Article&match_order=1&q=ç¼–è¯‘å™¨&zhida_source=entity)æŠŠæœ¬åœ°çš„(ç§æœ‰)å˜é‡æˆ–è€…æ–¹æ³•`localname`é“¾æ¥åˆ°æŒ‡å®šçš„å˜é‡æˆ–è€…æ–¹æ³•`importpath.name`ã€‚ç®€å•æ¥è¯´ï¼Œ`localname` `import.name`æŒ‡å‘çš„å˜é‡æˆ–è€…æ–¹æ³•æ˜¯åŒä¸€ä¸ªã€‚å› ä¸ºè¿™ä¸ªæŒ‡ä»¤ç ´åäº†ç±»å‹ç³»ç»Ÿå’ŒåŒ…çš„æ¨¡å—åŒ–åŸåˆ™ï¼Œåªæœ‰åœ¨å¼•å…¥ `unsafe` åŒ…çš„å‰æä¸‹æ‰èƒ½ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ã€‚

å“‡ï¼Œå¤ªé…·äº†ï¼Œä»–ä¸ä»…èƒ½å¸®åŠ©ä½ è°ƒç”¨å¤–éƒ¨åŒ…æœªå¯¼å‡ºçš„æ–¹æ³•ï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿç”¨æœ¬åœ°å®ç°å»æ›¿æ¢å¤–éƒ¨å®ç°ğŸ™Œã€‚ä½†è¿™å¾ˆå±é™©ï¼Œå› ä¸ºä½ å¾ˆéš¾è¯´æŸäº›æ–¹æ³•ä¸ä¼šéšç€goç‰ˆæœ¬çš„æ”¹å˜æˆ–è€…æŸäº›åŸºæœ¬æ–¹æ³•åˆ«çš„å¤–éƒ¨å®ç°æ²¡æœ‰è°ƒç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªä¸œè¥¿è¿˜æ˜¯è¦æ…ç”¨ï¼Œä¸€èˆ¬åªåœ¨ **è°ƒè¯•å·¥å…· / profiling agent / instrumentation agent** é‡Œä¼šè¿™ä¹ˆå¹²ã€‚

ç°åœ¨æ¥ä¸¤ä¸ªä»£ç ä¾‹å­æ„Ÿå—ä¸€ä¸‹ã€‚

```go
package main

import _ "unsafe"

//go:linkname nanotime runtime.nanotime
func nanotime() int64

func main() {
    println(nanotime()) // è·å–å½“å‰æ—¶é—´çš„çº³ç§’æ•°
}

```

ç¬¬ä¸€ä¸ªä¾‹å­å°±æ˜¯è°ƒç”¨çš„runtimeé‡Œçš„æœªå¯¼å‡ºçš„å‡½æ•°

```go
package main

import _ "unsafe"

//go:linkname nanotime runtime.nanotime
func nanotime() int64

func main() {
    println(nanotime()) // è·å–å½“å‰æ—¶é—´çš„çº³ç§’æ•°
}

```

ç¬¬äºŒä¸ªä¾‹å­é€šè¿‡æœªå¯¼å‡ºå®ç°å¯¼å‡ºå‡½æ•°

```go
package outer

import (
	_ "github.com/he2121/demos/linkname_example/inner"	// çœŸå®æ–¹æ³•åœ¨ inner åŒ…ï¼Œå¿…é¡»å¼•ç”¨è¿™ä¸ªç¼–è¯‘å™¨æ‰èƒ½æ‰¾åˆ°é“¾æ¥
)

func Hello()
```

```go
package inner

import (
	_ "unsafe"
)

//go:linkname hello github.com/he2121/demos/linkname_example/outer.Hello
func hello()  {
	println("hello")
}


```

```go
package main

import "github.com/he2121/demos/linkname_example/outer"

func main()  {
	outer.Hello()
	println(outer.A)
}
// output
// hello
// 100


```

å‚è€ƒèµ„æ–™ï¼š[Golang çš„éªšæ“ä½œï¼šgo:linknameèƒŒæ™¯ åœ¨çœ‹æºç æ—¶ï¼Œä¸€äº›æºç æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œéš¾é“è¯´æ˜è¿™äº›æ–¹æ³•ä¸ºç©ºï¼Ÿä¾‹å¦‚ï¼šti - æ˜é‡‘](https://juejin.cn/post/7037158518687793166)